---
layout: post
title: "[每日一库]点赞系统设计要点"
date: 2025-02-14
tags: [系统设计,每日一库]
comments: false
author: 小辣条
toc : false
---
点赞相信大家都不陌生，在B站，点赞是UP主们跟粉丝之间的特殊羁绊。B 站的点赞系统提供了对视频、动态、专栏、评论、弹幕等多种实体维度的点赞、点踩以及其余配套的数据查询的能力。
<!-- more -->
## 1、系统领域能力
- 对某个主题点赞和取消
- 查询是否对单个或一批主题点过赞
- 查询某个主题的点赞数
- 查询某个用户的点赞列表
- 查询某个主题的点赞人列表
- 查询用户收到的总点赞数
- 平台能力：快速配置和接入

## 2、设计要点
- 存储不可用、中间件不可用
- 写流量：内存聚合批量写，异步写
- 读流量：缓存+异步读
- 单点流量压力：热门主题导致单点流量压力：机制识别然后本地缓存+TTL

## 3、架构
![alt text](https://raw.githubusercontent.com/swh0318/swh0318.github.io/refs/heads/main/_posts/daily/assets/2025-02-14-agreen_system/image.png)

- TiDB: 点赞记录表、点赞计数表
- 缓存：点赞数、用户点赞列表(zset固定长度，超过需要回源)
- localcache: 最小堆算法识别热点key

- 存储（db、redis等）的容灾设计（同城多活）
- 服务的容灾与降级: 兜底数据返回
- binlog同步：异步写入
- 读写分离：读写分离，读请求走从库
- 监控告警

## 参考
B站千亿级点赞系统服务架构设计